---
title: "Create a regular order using the Checkout API"
slug: "test-spotlight"
hidden: false
createdAt: "2023-07-18T17:08:52.219Z"
updatedAt: "2023-07-18T17:08:52.219Z"
excerpt: "Learn how place orders using VTEX APIs to handle shopping carts and checkout."
hideTOC: true
---

This step-by-step guide will walk you through the process of using the [Checkout API](https://developers.vtex.com/docs/api-reference/checkout-api) for handling the placement, payment, and delivery aspects of a regular order, with all responsibilities managed within the scope of a single account. This process involves the following steps:

1. **Assess cart requirements:** The process initiates with the simulation of a cart to assess the available delivery and payment options. Additionally, since indicating an email address is necessary to place an order, this step also includes verifying the existence of a customer by cross-referencing their email address in the database.
2. **Assemble the cart:** After assessing the cart requirements, the next step is to meticulously assemble the cart, ensuring that all essential order information is organized accurately under the [`orderForm`](https://developers.vtex.com/docs/guides/orderform-fields) object.
3. **Handle the order:** This step involves placing the order on the VTEX platform, sending the necessary payment data to resolve the order payment and processing order details.
4. **Verify order placement:** The process ends with a verification procedure to confirm the successful placement of the order.

> ✅ Click the steps below to navigate through this article and explore specific topics. Relevant code will be highlighted and focused for your convenience.

<CH.Spotlight>


<CH.Code>

```shell Shell mark=2[18:30],2[32:44],5[32:39],6[34:43]
curl --request post \
  --url 'https://{accountname}.{environment}.com.br/api/checkout/pub/orderForms/simulation?RnbBehavior=0' \
  --header 'Accept: application/json' \
  --header 'Content-Type: application/json' \
  --header 'X-VTEX-API-AppKey: {appKey}' \
  --header 'X-VTEX-API-AppToken: {appToken}' \
  --data '{"items":[{"id":"1","quantity":1,"seller":"1"}],"country":"BRA","postalCode":"12345-000","geoCoordinates":[-47.924747467041016]}'
```

```python Python
import http.client

conn = http.client.HTTPSConnection("{accountname}.{environment}.com.br")

payload = "{\"items\":[{\"id\":\"1\",\"quantity\":1,\"seller\":\"1\"}],\"country\":\"BRA\",\"postalCode\":\"12345-000\",\"geoCoordinates\":[-47.924747467041016]}"

headers = {
    'Accept': "application/json",
    'Content-Type': "application/json",
    'X-VTEX-API-AppKey': "",
    'X-VTEX-API-AppToken': ""
    }

conn.request("post", "/api/checkout/pub/orderForms/simulation?RnbBehavior=0", payload, headers)

res = conn.getresponse()
data = res.read()

print(data.decode("utf-8"))
```

```js Node.js mark=5[15:27],5[29:41]
const http = require("https");

const options = {
 "method": "post",
 "hostname": "{accountname}.{environment}.com.br",
 "port": null,
 "path": "/api/checkout/pub/orderForms/simulation?RnbBehavior=0",
 "headers": {
  "Accept": "application/json",
  "Content-Type": "application/json",
  "X-VTEX-API-AppKey": "",
  "X-VTEX-API-AppToken": ""
 }
};

const req = http.request(options, function (res) {
 const chunks = [];

 res.on("data", function (chunk) {
  chunks.push(chunk);
 });

 res.on("end", function () {
  const body = Buffer.concat(chunks);
  console.log(body.toString());
 });
});

req.write(JSON.stringify({
  items: [{id: '1', quantity: 1, seller: '1'}],
  country: 'BRA',
  postalCode: '12345-000',
  geoCoordinates: [-47.924747467041016]
}));
req.end();
```

```json Response
{
  "allowManualPrice": boolean,
  "canEditData": boolean,
  "clientPreferencesData": {},
  "clientProfileData": {},
  "commercialConditionData": {},
  "customData": {},
  "giftRegistryData": {},
  "hooksData": {},
  "ignoreProfileData": boolean,
  "isCheckedIn": boolean,
  "itemMetadata": {},
  "items": {},
  "itemsOrdination": {},
  "loggedIn": boolean,
  "marketingData": {},
  "messages": [],
  "openTextField": {},
  "orderFormId": string,
  "paymentData": {},  
  "ratesAndBenefitsData": {},
  "salesChannel": "1",
  "selectableGifts": {},
  "sellers": {},
  "shippingData": {},
  "storeId": {},
  "storePreferencesData": {},
  "totalizers": {},
  "userProfileId": {},
  "userType": {},
  "value": number
}
```


```json orderForm
{
  "allowManualPrice": boolean,
  "canEditData": boolean,
  "clientPreferencesData": {},
  "clientProfileData": {},
  "commercialConditionData": {},
  "customData": {},
  "giftRegistryData": {},
  "hooksData": {},
  "ignoreProfileData": boolean,
  "isCheckedIn": boolean,
  "itemMetadata": {},
  "items": {},
  "itemsOrdination": {},
  "loggedIn": boolean,
  "marketingData": {},
  "messages": [],
  "openTextField": {},
  "orderFormId": string,
  "paymentData": {},  
  "ratesAndBenefitsData": {},
  "salesChannel": "1",
  "selectableGifts": {},
  "sellers": {},
  "shippingData": {},
  "storeId": {},
  "storePreferencesData": {},
  "totalizers": {},
  "userProfileId": {},
  "userType": {},
  "value": number
}
```

</CH.Code>

## Before you begin

Before proceeding any further, ensure that you have a valid `appKey` and `appToken` granted with the necessary permissions to access the Checkout and Payments Gateway APIs. For more information, please refer to the [Roles](https://help.vtex.com/en/tutorial/roles--7HKK5Uau2H6wxE1rH5oRbc) article.

---

## Step 1 - Assessing cart requirements

In this step, we will assess the cart requirements and collect the necessary information about the order to ensure a smooth order placement process in the subsequent steps.

### Simulating a cart

This step will provide essential information regarding the available delivery and payment options for the specific combination of items in the cart.

- Send a request to the [`Cart simulation`](https://developers.vtex.com/docs/api-reference/checkout-api#post-/api/checkout/pub/orderForms/simulation) API endpoint. You must specify an SKU ID (`items.id`), the number of items in the cart (`items.quantity`), and the Seller's ID (`items.seller`) in the request body.
- Take note of the `items`, `shippingData.logisticsInfo`, and `paymentData` objects as we will use this data in the following steps.

<CH.Code>

```shell Shell mark=2[18:30],2[32:44],5[32:39],6[34:43]
```

```python Python mark=3[37:49],3[51:63]
```

```js Node.js mark=5[15:27],5[29:41]
```

---

```json Response focus=13,20,25
```

</CH.Code>

---

### Checking for existing customer

This step will check if the customer already exists in your database. This verification serves to not only enhance operational efficiency but also proactively prevent potential permission-related issues.

- Send a request to the [`Get client by email`](https://developers.vtex.com/docs/api-reference/checkout-api#get-/api/checkout/pub/profiles) endpoint to check for existing profiles associated with a specific email address. If the response to this request returns any content, it means that you already have this shopper’s information in your database. In such cases, you can seamlessly proceed to utilize this information in the subsequent steps, sparing the shopper from the need to provide it again.
- If applicable, take note of the `availableAddresses` and `userProfile` objects as we will use this data in the following steps.

<CH.Code>

```shell Shell mark=2[18:30],2[32:44],2[85:98],5[32:39],6[34:43]
curl --request get \
  --url 'https://{accountname}.{environment}.com.br/api/checkout/pub/profiles?email={emailAddress}' \
  --header 'Accept: application/json' \
  --header 'Content-Type: application/json' \
  --header 'X-VTEX-API-AppKey: {appKey}' \
  --header 'X-VTEX-API-AppToken: {appToken}'
```

```python Python mark=3[37:49],3[51:63]
import http.client

conn = http.client.HTTPSConnection("{accountname}.{environment}.com.br")

headers = {
    'Accept': "application/json",
    'Content-Type': "application/json",
    'X-VTEX-API-AppKey': "",
    'X-VTEX-API-AppToken': ""
    }

conn.request("get", "/api/checkout/pub/profiles?email={emailAddress}", headers=headers)

res = conn.getresponse()
data = res.read()

print(data.decode("utf-8"))
```

```js Node.js mark=5[15:27],5[29:41]
const http = require("https");

const options = {
 "method": "get",
 "hostname": "{accountname}.{environment}.com.br",
 "port": null,
 "path": "/api/checkout/pub/profiles?email={emailAddress}",
 "headers": {
  "Accept": "application/json",
  "Content-Type": "application/json",
  "X-VTEX-API-AppKey": "",
  "X-VTEX-API-AppToken": ""
 }
};

const req = http.request(options, function (res) {
 const chunks = [];

 res.on("data", function (chunk) {
  chunks.push(chunk);
 });

 res.on("end", function () {
  const body = Buffer.concat(chunks);
  console.log(body.toString());
 });
});

req.end();
```

---

```json Response focus=6:20,24:35
{
  "userProfileId": string,
  "profileProvider": string,
  "availableAccounts": [],
  "availableAddresses": [
    {
      "addressType": string,
      "receiverName": string,
      "addressId": string,
      "isDisposable": boolean,
      "postalCode": string,
      "city": string,
      "state": string,
      "country": string,
      "street": string,
      "number": string,
      "neighborhood": string,
      "complement": null,
      "reference": null,
      "geoCoordinates": []
    }
  ],
  "userProfile": {
    "email": string,
    "firstName": string,
    "lastName": string,
    "document": string,
    "documentType": string,
    "phone": string,
    "corporateName": null,
    "tradeName": null,
    "corporateDocument": null,
    "stateInscription": null,
    "corporatePhone": null,
    "isCorporate": boolean,
    "profileCompleteOnLoading": null,
    "profileErrorOnLoading": null,
    "customerClass": null
  },
  "isComplete": boolean
}
```

</CH.Code>

---

## Step 2 - Assembling the cart

Organize order details into the designated data format, adhering to the [`orderForm`](https://developers.vtex.com/docs/guides/orderform-fields) data structure. This formatted cart data will serve as the request body in subsequent steps.

Note that, an [orderForm](https://developers.vtex.com/docs/guides/orderform-fields) can encompass numerous elements, but a standard order primarily consists of the following:

- `items`
- `clientProfileData`
- `shippingData.address`
- `shippingData.logisticsInfo`
- `paymentData`

Below, we briefly explore each of these objects.

<CH.Code  show={["orderForm"]}>
```json orderForm focus=5,13,25,20
```
</CH.Code>
---

### `items`

With the `items` array obtained from the [Simulating a cart](#simulating-a-cart) step, build an array containing all data pertinent to the SKUs being purchased. To explore more complex examples, see the [Place order](https://developers.vtex.com/docs/api-reference/checkout-api#put-/api/checkout/pub/orders) API reference.

<CH.Code  show={["orderForm"]}>

```json orderForm focus=2:9
{
  "items": [
      {
          "id": "1",
          "quantity": 1,
          "seller": "1",
          "price": 10000
      }
  ],
  "clientProfileData": {},
  "shippingData": {
      "address": {},
      "logisticsInfo": []
  },
  "paymentData": {}
}
```

</CH.Code>

---

### `clientProfileData`: New customers

If the customer does not exist in your database, build the `clientProfileData` object with the data of the customer who will place the order.

<CH.Code>

```json orderForm focus=3:16
{
  "items": [],
  "clientProfileData": {
      "email": "email@domain.com",
      "firstName": "Testing",
      "lastName": "VTEX",
      "document": "078051120",
      "documentType": "ssn",
      "phone": "1234567890",
      "corporateName": null,
      "tradeName": null,
      "corporateDocument": null,
      "stateInscription": null,
      "corporatePhone": null,
      "isCorporate": false
  },
  "shippingData": {
      "address": {},
      "logisticsInfo": []
  },
  "paymentData": {}
}
```

</CH.Code>

---

### `clientProfileData`: Existing customers

If the customer already exists in your datababe, use the `clientProfileData` array obtained in the [Checking for existing customer](#checking-for-existing-customer) step to build a block containing the `clientProfileData.email`. Note that the email address is enough to register the order to the shopper’s existing account.

<CH.Code>

```json orderForm focus=3:5
{
  "items": [],
  "clientProfileData": {
      "email": "email@domain.com"
  },
  "shippingData": {
      "address": {},
      "logisticsInfo": []
  },
  "paymentData": {}
}
```

</CH.Code>

---

### `shippingData.address`: New customers

If the customer does not exist in your database, build the `shippingData.address` object with the data of the customer who will place the order.


<CH.Code>

```json orderForm focus=4:19
{
  "items": [],
  "clientProfileData": {},
  "shippingData": {
      "address": {
          "addressType": "residential",
          "receiverName": "Testing VTEX",
          "postalCode": "33301",
          "city": "Fort Lauderdale",
          "state": "FL",
          "country": "USA",
          "street": "110 East Broward Blvd",
          "number": null,
          "neighborhood": null,
          "complement": "Suite 1700",
          "reference": null,
          "geoCoordinates": []
      }
  },
  "paymentData": {}
}
```

</CH.Code>

---

### `shippingData.address`: Existing customers

If the customer already exists in your datababe, use the `addressId` obtained from the [Checking for existing customer](#checking-for-existing-customer) step to build a block containing the `shippingData.addressId`.

<CH.Code>

```json orderForm focus=4:8
{
  "items": [],
  "clientProfileData": {},
  "shippingAddress": {
      "address": {
          "addressId": "666c2e830bd9474ab6f6cc53fb6dd2d2"
      }
  },
  "paymentData": {}
}
```

</CH.Code>

---

### `shippingData.logisticsInfo`

- Create the `logisticsInfo` array to store logistics information, such as the desired delivery option and freight cost for each item in the `items` array. This array will contain the same number of objects as in the `items` array. For each object within the `logisticsInfo` array:

  - Define the `itemIndex` to match the index of the corresponding item in the `items` array. For example, the object referring to the first item in `items` array has an `itemIndex` of `0`.
  - Define the selected delivery option in the `selectedSla`. You can find the `id` value of the available options in the `slas` array obtained at the [Simulating a cart](#simulating-a-cart) step.
  - Set the item's price in the `price` field, which you can retrieve from the [Simulating a cart](#simulating-a-cart) step.

<CH.Code>

```json focus=4:13
{
  "items": [],
  "clientProfileData": {},
  "shippingData": {
    "address": {},
    "logisticsInfo": [
        {
            "itemIndex": 0,
            "selectedSla": "Regular",
            "price": 100
        }
    ]
  },
  "paymentData": {}
}
```

</CH.Code>

---

### `paymentData`

This object informs the payment method and installment options (if available) selected for the order.

Note that the `value` field corresponds to the full value to be payed by the shopper, whereas the `referenceValue` is the base number over which interests apply. If no interest apply to the order, they should be equal.

> ℹ️️ For this example, we are considering a single payment method, with a single installment and no interest. To learn more and explore more complex examples see the [Place order API request documentation.](https://developers.vtex.com/docs/api-reference/checkout-api#put-/api/checkout/pub/orders)

Use the options and information from the cart simulation (step one) response to assemble your own `paymentData`.

<CH.Code>

```json orderForm focus=8:17
{
  "items": [],
  "clientProfileData": {},
  "shippingData": {
      "address": {},
      "logisticsInfo": []
  },
  "paymentData": {
      "payments": [
          {
              "paymentSystem": "1",
              "referenceValue": 10100,
              "value": 10100,
              "installments": 1
          }
      ]
  }
}
```

</CH.Code>

</CH.Spotlight>